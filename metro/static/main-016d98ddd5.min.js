var httpBase="http://localhost:8080/",httpBase="";angular.module("xs1h",["ionic","template"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(n,e,t){e.when("","/shop"),n.state("shop",{url:"/shop/:storeId/:orderNumber",views:{mainContent:{templateUrl:"template/shop.html",controller:"shopCtrl"}}}).state("orderpay",{url:"/orderpay?storeId&orderNumber",views:{mainContent:{templateUrl:"template/order-pay.html",controller:"orderPayCtrl"}}}).state("paysuccess",{url:"/paysuccess",views:{mainContent:{templateUrl:"template/pay-success.html",controller:"paySuccessCtrl"}}}).state("order",{url:"/order",templateUrl:"template/order.html",controller:"orderCtrl"}),t.interceptors.push("timestampMarker")}]),angular.module("xs1h").run(["$rootScope","$http",function(n,e){var t=location.href.split("#")[0];e.post("index/getConfig",{texr:1}).success(function(e){0==e.statusCode&&(n.global=e.data)}),e.post("index/getWeChatJsSign?url="+t,{url:t}).success(function(e,t,a,i){if(0==e.statusCode){var s=angular.fromJson(e.data);wx.config(s),wx.ready(function(){wx.hideOptionMenu(),n.wxReady=!0})}})}]),function(n){try{n=angular.module("template")}catch(e){n=angular.module("template",[])}n.run(["$templateCache",function(n){n.put("template/order-pay.html",'<ion-view class="pay">\n    <ion-header-bar align-title="center" class="bar-energized">\n<!--         <a class="btn-back" ng-click="go(-1)"></a>\n -->        <h1 class="title">订单支付</h1>\n    </ion-header-bar>\n    <ion-content overflow-scroll="false">\n        <div >\n            <div class="item item-divider">\n                预定餐品\n                <span class="pull-right">共{{order.commodityNumber}}件</span>\n            </div>\n            <ul class="list">\n                <li class="xs-item1" ng-repeat="item in order.commodityList">\n                    <img ng-src="{{global.adminUrl+item.commodityImg}}"/>\n                    <div class="desc">\n                        <p ng-bind="item.commodityName"></p>\n                        <div class="bottom">\n                            <span class="txt-price" ng-bind="item.promotion|currency :\'￥\'"></span>\n                            <div class="number">\n                                <span class="count" ng-bind="\'× \'+item.totalNum"></span>\n                            </div>\n                        </div>\n                    </div>\n                </li>\n            </ul>\n          \n            \n            <div class="item item-divider title">\n                餐品费用\n                <span class="pull-right" ng-bind="order.total|currency :\'￥\'"></span>\n            </div>\n           \n            \n            <div></div>\n            <div class="item item-divider title">\n                支付方式\n            </div>\n            <div class="payType">\n                <i class="payIcon"></i>\n                <span class="supportType">微信支付</span>\n                <span class="tip">暂时只支持微信支付</span>\n            </div>\n        </div>\n     \n    </ion-content>\n    <div ng-if="paying" class="payLoadingBG">\n        <div class="outside">\n            <div class="confirm-content fade in">\n                <div>\n                    <span>支付中...</span>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="bar bar-footer bar-dark" >\n        <div class="row-basket">\n            <button  class="pull-right" ng-click="submitOrder()" ng-disabled="paying">\n                <a class="btn-o-tobuy font16">确认支付</a>\n            </button>\n          \n            <div class="media media-basket">\n                <div class="media-left">\n                    <div class="type2">\n                        <span>实付款:</span>\n                    </div>\n                </div>\n                <div class="media-body">\n                    <div class="media-heading" ng-bind="\'￥\'+ order.total"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n  \n</ion-view>\n')}])}(),function(n){try{n=angular.module("template")}catch(e){n=angular.module("template",[])}n.run(["$templateCache",function(n){n.put("template/order.html","")}])}(),function(n){try{n=angular.module("template")}catch(e){n=angular.module("template",[])}n.run(["$templateCache",function(n){n.put("template/pay-success.html",'<ion-view class="pay">\n    <ion-header-bar align-title="center" class="bar-energized">\n<!--         <a class="btn-back" ng-click="go(-1)"></a>\n -->        <h1 class="title">预定成功</h1>\n    </ion-header-bar>\n<div class="pay-success">\n	<img src="metro/static/img/pay-success.png" style="width:100%" />\n	<a href="index.html" class="xs-btn">去首页逛逛</a>\n</div>\n	</ion-view>')}])}(),function(n){try{n=angular.module("template")}catch(e){n=angular.module("template",[])}n.run(["$templateCache",function(n){n.put("template/shop.html",'<ion-view class="itemList">\n    <ion-header-bar align-title="center" class="bar-energized">\n        <div class="title">\n            <span class="container icon">\n                <span ng-bind="$parent.currStore.name" class="storeName ng-binding"></span>\n            </span>\n        </div>\n    </ion-header-bar>\n    <ion-content delegate-handle="mainScroll" scroll-event-interval="800" on-scroll="swipe()" overflow-scroll="false">\n        <div class="mainContent">\n            <div class="list-content">\n                <ul class="list">\n                    <li class="xs-item1" ng-class="{\'item-divider\':item.name}" ng-repeat="item in totalItemList track by $index" ng-style="{true:{\'height\':\'{{item.height+\'px\'}}\'}}[item.empty]">\n                        <span ng-if="item.name">{{::item.name}}</span>\n                        <!--<img ng-if="!item.name && !item.empty" ng-src="{{::(imgRoot + item.scan)}}" ui-sref="commodity-detail({commodityId:item.commodityId})" />-->\n                        <img ng-if="!item.name && !item.empty" ng-src="{{::(imgRoot + item.scan)}}" />\n                        <div class="desc" ng-if="!item.name && !item.empty">\n                            <p class="title">{{::item.commodityName}}</p>\n                            <div>\n                                <i class="icon-am" ng-if="item.mealId == 2 || item.mealId == 1"></i>\n                                <i class="icon-mm" ng-if="item.mealId == 3 || item.mealId == 1"></i>\n                                <i class="icon-pm" ng-if="item.mealId == 4 || item.mealId == 1"></i>\n                            </div>\n                            <div class="bottom">\n                                <span class="txt-price">￥{{::item.promotion}}</span>\n                                <div class="number">\n                                <span class="minusCount">\n                                    <div ng-show="item.count > 0" style="display: table">\n                                        <span class="minus" ng-click="removeItem(item)"></span>\n                                        <span class="count" ng-bind="item.count"></span>\n                                    </div>\n                                </span>\n                                    <span class="plus" ng-click="addItem(item)"></span>\n                                </div>\n                            </div>\n                        </div>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </ion-content>\n    <div class="bar bar-footer bar-dark">\n        <div class="row-basket">\n            <div class="pull-right" ng-click="go(\'shoppingCart\')" style="pointer-events: auto;">\n                <a class="btn-o-tobuy {{shoppingCartTotalPrice <= 0 ? \'btn-o-tobuy-none\' : \'font16\'}}" ng-bind="shoppingCartTotalPrice > 0 ? \'去结算\':\'选择任意餐品\'"></a>\n            </div>\n            <div class="media media-basket">\n                <div class="media-left">\n                    <img class="media-object" src="img/home/basket.png" ng-click="basketShow = basketShow ? !basketShow:true">\n                    <div class="xs-badge">\n                        <span class="badge" ng-bind="shoppingCartTotalNum"></span>\n                    </div>\n                </div>\n                <div class="media-body">\n                    <div class="media-heading" ng-bind="\'￥\' + (shoppingCartTotalPrice|number:2)"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</ion-view>')}])}(),angular.module("xs1h").controller("orderCtrl",["$scope","$state","$http","$timeout","$ionicModal","$rootScope","$ionicLoading","$ionicPopup","$ionicScrollDelegate","$ionicBackdrop","$stateParams",function(n,e,t,a,i,s,o,l,r,c,d){}]),angular.module("xs1h").controller("orderPayCtrl",["$scope","$state","$http","$timeout","$ionicModal","$rootScope","$ionicLoading","$ionicPopup","$ionicScrollDelegate","$ionicBackdrop","$stateParams","$rootScope",function(n,e,t,a,i,s,o,l,r,c,d,s){function m(){n.paying=!1}t.post("order/findOrderByNumber",d).success(function(e){if(0==e.statusCode){n.order=e.data;for(var t=0,a=n.order.commodityList,i=0;i<a.length;i++)t+=a[i].totalNum;n.order.commodityNumber=t}}),n.quickPay=function(){s.wxReady?n.submitOrder():a(function(){n.quickPay()},1e3)},n.quickPay(),n.submitOrder=function(){n.paying=!0,t.post("order/payOrderOnly",d).success(function(a){if(0==a.statusCode){var i=angular.fromJson(a.data.payConfig),s=a.data.orderCode;i.success=function(n){t.get("order/paySuccessScan?orderCode="+s).success(function(n,t,a,i){0==n.statusCode?e.go("paySuccessCtrl"):alert(n.statusMessage)}),m()},i.cancel=function(n){m()},m(),wx.chooseWXPay(i).error(function(){m()})}else n.paying=!1})}}]),angular.module("xs1h").controller("paySuccessCtrl",[function(){}]),angular.module("xs1h").controller("shopCtrl",["$scope","$state","$http","$timeout","$ionicModal","$rootScope","$ionicLoading","$ionicPopup","$ionicScrollDelegate","$ionicBackdrop","$stateParams",function(n,e,t,a,i,s,o,l,r,c,d){t.post("order/findOrderByNumber",d).success(function(n){})}]),angular.module("xs1h").factory("timestampMarker",[function(){var n={request:function(n){var e=arguments[0].headers;return"application/json"==(e.Accept&&e.Accept.split(",")[0])&&n.url.indexOf("template")<0&&(n.url=httpBase+n.url),n},response:function(n){return n}};return n}]);